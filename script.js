
let json = JSON.parse('{"departures":[[{"number":"6919","hour":"14h30","destination":"Grenoble","track":"1","notes":{"text":"Départ","color":"green"}},{"number":"6715","hour":"14h32","destination":"Gare De L’est","track":"5","notes":{"text":"A L’Heure","color":"none"}},{"number":"6577","hour":"14h33","destination":"Geneve","track":"15","notes":{"text":"Retard 1m","color":"red"}},{"number":"7907","hour":"14h38","destination":"Montpellier","track":"9","notes":{"text":"A L’Heure","color":"none"}},{"number":"6213","hour":"14h47","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"9249","hour":"15h14","destination":"Milano","track":"11","notes":{"text":"Retard 6m","color":"red"}},13],[{"number":"6715","hour":"14h32","destination":"Gare De L’est","track":"5","notes":{"text":"Embarquement","color":"green"}},{"number":"6577","hour":"14h33","destination":"Geneve","track":"15","notes":{"text":"Retard 1m","color":"red"}},{"number":"7907","hour":"14h38","destination":"Montpellier","track":"9","notes":{"text":"A L’Heure","color":"none"}},{"number":"6213","hour":"14h47","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"9249","hour":"15h14","destination":"Milano","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"6179","hour":"15h20","destination":"Hyeres","track":"2","notes":{"text":"A L’Heure","color":"none"}},13],[{"number":"6715","hour":"14h32","destination":"Gare De L’est","track":"5","notes":{"text":"Embarquement","color":"green"}},{"number":"6577","hour":"14h33","destination":"Geneve","track":"15","notes":{"text":"Embarquement","color":"green"}},{"number":"7907","hour":"14h38","destination":"Montpellier","track":"9","notes":{"text":"A L’Heure","color":"none"}},{"number":"6213","hour":"14h47","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"9249","hour":"15h14","destination":"Milano","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"6179","hour":"15h20","destination":"Hyeres","track":"2","notes":{"text":"A L’Heure","color":"none"}},13],[{"number":"6715","hour":"14h32","destination":"Gare De L’est","track":"5","notes":{"text":"Départ","color":"green"}},{"number":"6577","hour":"14h33","destination":"Geneve","track":"15","notes":{"text":"Embarquement","color":"green"}},{"number":"7907","hour":"14h38","destination":"Montpellier","track":"9","notes":{"text":"A L’Heure","color":"none"}},{"number":"6213","hour":"14h47","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"9249","hour":"15h14","destination":"Milano","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"6179","hour":"15h20","destination":"Hyeres","track":"2","notes":{"text":"A L’Heure","color":"none"}},13],[{"number":"1239","hour":"15h44","destination":"Hyeres","track":"16","notes":{"text":"Départ","color":"green"}},{"number":"1316","hour":"15h47","destination":"Lyon","track":"3","notes":{"text":"Embarquement","color":"green"}},{"number":"9114","hour":"15h52","destination":"Marseille","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Nice","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Saint-Michel","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Grenoble","track":"17","notes":{"text":"A L’Heure","color":"none"}},12],[{"number":"1316","hour":"15h47","destination":"Lyon","track":"3","notes":{"text":"Embarquement","color":"green"}},{"number":"9114","hour":"15h52","destination":"Marseille","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Nice","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Saint-Michel","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Grenoble","track":"17","notes":{"text":"A L’Heure","color":"none"}},{"number":"8569","hour":"16h12","destination":"Champ de Mars","track":"8","notes":{"text":"Retard 9m","color":"red"}},13],[{"number":"1316","hour":"15h47","destination":"Lyon","track":"3","notes":{"text":"Départ","color":"green"}},{"number":"9114","hour":"15h52","destination":"Marseille","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Nice","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Saint-Michel","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Grenoble","track":"17","notes":{"text":"A L’Heure","color":"none"}},{"number":"8569","hour":"16h12","destination":"Champ de Mars","track":"8","notes":{"text":"Retard 9m","color":"red"}},13],[{"number":"1239","hour":"15h44","destination":"Lyon","track":"16","notes":{"text":"Départ","color":"green"}},{"number":"1316","hour":"15h47","destination":"Anvers","track":"3","notes":{"text":"A L’Heure","color":"none"}},{"number":"9114","hour":"15h52","destination":"Saint-Lazare","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Grenoble","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Nice","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Lyon","track":"17","notes":{"text":"A L’Heure","color":"none"}},12],[{"number":"1316","hour":"15h47","destination":"Anvers","track":"3","notes":{"text":"Embarquement","color":"green"}},{"number":"9114","hour":"15h52","destination":"Saint-Lazare","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Grenoble","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Nice","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Lyon","track":"17","notes":{"text":"A L’Heure","color":"none"}},{"number":"8569","hour":"16h12","destination":"Champ de Mars","track":"8","notes":{"text":"Retard 9m","color":"red"}},13],[{"number":"1316","hour":"15h47","destination":"Anvers","track":"3","notes":{"text":"Départ","color":"green"}},{"number":"9114","hour":"15h52","destination":"Saint-Lazare","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Grenoble","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Nice","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Lyon","track":"17","notes":{"text":"A L’Heure","color":"none"}},{"number":"8569","hour":"16h12","destination":"Champ de Mars","track":"8","notes":{"text":"Retard 9m","color":"red"}},13],[{"number":"9114","hour":"15h52","destination":"Saint-Lazare","track":"10","notes":{"text":"Retard Ind","color":"red"}},{"number":"4813","hour":"15h55","destination":"Grenoble","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"7351","hour":"16h01","destination":"Nice","track":"9","notes":{"text":"Retard 2m","color":"red"}},{"number":"2492","hour":"16h03","destination":"Lyon","track":"17","notes":{"text":"A L’Heure","color":"none"}},{"number":"8569","hour":"16h12","destination":"Champ de Mars","track":"8","notes":{"text":"Retard 9m","color":"red"}},{"number":"6632","hour":"16h16","destination":"Bordeaux","track":"12","notes":{"text":"A L’Heure","color":"none"}},13]],"arrivals":[[{"number":"8590","hour":"14:30","destination":"Champ de Mars","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"8620","hour":"14:31","destination":"Chatelet-les-Halles","track":"2","notes":{"text":"A L’Heure","color":"none"}},{"number":"8084","hour":"14:35","destination":"Bercy Metro","track":"6","notes":{"text":"A L’Heure","color":"none"}},{"number":"7653","hour":"14:48","destination":"Gare du Nord","track":"8","notes":{"text":"Retard 5m","color":"red"}},{"number":"8413","hour":"14:59","destination":"Grenoble","track":"21","notes":{"text":"Retard 2m","color":"red"}},{"number":"3441","hour":"15h03","destination":"Bercy Metro","track":"14","notes":{"text":"A L’Heure","color":"none"}},19],[{"number":"8590","hour":"14:30","destination":"Champ de Mars","track":"4","notes":{"text":"Arrivant","color":"none"}},{"number":"8620","hour":"14:31","destination":"Chatelet-les-Halles","track":"2","notes":{"text":"A L’Heure","color":"none"}},{"number":"8084","hour":"14:35","destination":"Bercy Metro","track":"6","notes":{"text":"A L’Heure","color":"none"}},{"number":"7653","hour":"14:48","destination":"Gare du Nord","track":"8","notes":{"text":"Retard 5m","color":"red"}},{"number":"8413","hour":"14:59","destination":"Grenoble","track":"21","notes":{"text":"Retard 2m","color":"red"}},{"number":"3441","hour":"15h03","destination":"Bercy Metro","track":"14","notes":{"text":"A L’Heure","color":"none"}},19],[{"number":"8620","hour":"14:31","destination":"Chatelet-les-Halles","track":"2","notes":{"text":"Arrivant","color":"none"}},{"number":"8084","hour":"14:35","destination":"Bercy Metro","track":"6","notes":{"text":"A L’Heure","color":"none"}},{"number":"7653","hour":"14:48","destination":"Gare du Nord","track":"8","notes":{"text":"Retard 5m","color":"red"}},{"number":"8413","hour":"14:59","destination":"Grenoble","track":"21","notes":{"text":"Retard 2m","color":"red"}},{"number":"3441","hour":"15h03","destination":"Bercy Metro","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"8412","hour":"15h07","destination":"Le Mans","track":"12","notes":{"text":"A L’Heure","color":"none"}},19],[{"number":"8084","hour":"14:35","destination":"Bercy Metro","track":"6","notes":{"text":"A L’Heure","color":"none"}},{"number":"7653","hour":"14:48","destination":"Gare du Nord","track":"8","notes":{"text":"Retard 5m","color":"red"}},{"number":"8413","hour":"14:59","destination":"Grenoble","track":"21","notes":{"text":"Retard 2m","color":"red"}},{"number":"3441","hour":"15h03","destination":"Bercy Metro","track":"14","notes":{"text":"A L’Heure","color":"none"}},{"number":"8412","hour":"15h07","destination":"Le Mans","track":"12","notes":{"text":"A L’Heure","color":"none"}},{"number":"7656","hour":"15h10","destination":"Nantes","track":"5","notes":{"text":"A L’Heure","color":"none"}},12],[{"number":"8695","hour":"15:45","destination":"Saint-Michel","track":"9","notes":{"text":"A L’Heure","color":"none"}},{"number":"8027","hour":"15h48","destination":"Milano","track":"22","notes":{"text":"A L’Heure","color":"none"}},{"number":"7115","hour":"15h59","destination":"Bercy Metro","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Laroche","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Bordeaux","track":"5","notes":{"text":"Retard 8m","color":"red"}},12],[{"number":"8695","hour":"15:45","destination":"Saint-Michel","track":"9","notes":{"text":"Arrivant","color":"none"}},{"number":"8027","hour":"15h48","destination":"Milano","track":"22","notes":{"text":"A L’Heure","color":"none"}},{"number":"7115","hour":"15h59","destination":"Bercy Metro","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Laroche","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Bordeaux","track":"5","notes":{"text":"Retard 8m","color":"red"}},12],[{"number":"8027","hour":"15h48","destination":"Milano","track":"22","notes":{"text":"A L’Heure","color":"none"}},{"number":"7115","hour":"15h59","destination":"Bercy Metro","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Laroche","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Nice","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Bordeaux","track":"5","notes":{"text":"Retard 8m","color":"red"}},{"number":"9262","hour":"16h17","destination":"Gare de Lyon","track":"26","notes":{"text":"Retard 1m","color":"red"}},12],[{"number":"8695","hour":"15:45","destination":"Saint-Lazare","track":"1","notes":{"text":"A L’Heure","color":"none"}},{"number":"8027","hour":"15h48","destination":"Laroche","track":"22","notes":{"text":"A L’Heure","color":"none"}},{"number":"7115","hour":"15h59","destination":"Marseille","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Lyon","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Bercy Metro","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Chatelet-les-Halles","track":"5","notes":{"text":"Retard 8m","color":"red"}},19],[{"number":"8695","hour":"15:45","destination":"Saint-Lazare","track":"1","notes":{"text":"Arrivant","color":"none"}},{"number":"8027","hour":"15h48","destination":"Laroche","track":"22","notes":{"text":"A L’Heure","color":"none"}},{"number":"7115","hour":"15h59","destination":"Marseille","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Lyon","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Bercy Metro","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Chatelet-les-Halles","track":"5","notes":{"text":"Retard 8m","color":"red"}},19],[{"number":"8027","hour":"15h48","destination":"Laroche","track":"22","notes":{"text":"Arrivant","color":"none"}},{"number":"7115","hour":"15h59","destination":"Marseille","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Lyon","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Bercy Metro","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Chatelet-les-Halles","track":"5","notes":{"text":"Retard 8m","color":"red"}},{"number":"9262","hour":"16h17","destination":"Montpellier","track":"26","notes":{"text":"Retard 1m","color":"red"}},19],[{"number":"7115","hour":"15h59","destination":"Marseille","track":"19","notes":{"text":"A L’Heure","color":"none"}},{"number":"6458","hour":"16h02","destination":"Lyon","track":"11","notes":{"text":"Retard 6m","color":"red"}},{"number":"8231","hour":"16h08","destination":"Bercy Metro","track":"4","notes":{"text":"A L’Heure","color":"none"}},{"number":"4331","hour":"16h11","destination":"Chatelet-les-Halles","track":"5","notes":{"text":"Retard 8m","color":"red"}},{"number":"9262","hour":"16h17","destination":"Montpellier","track":"26","notes":{"text":"Retard 1m","color":"red"}},{"number":"2356","hour":"16h19","destination":"Hyeres","track":"12","notes":{"text":"A L’Heure","color":"none"}},19]]}')

var infoOptions = {
    width: 31,             // number of digits
    format: null,         // options for jquery.numberformatter, if loaded
    align: 'left',       // aligns values to the left or right of display
    padding: '&nbsp;',    // value to use for padding
    chars: null,          // array of characters that Flapper can display
    chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
    timing: 500,          // the maximum timing for digit animation
    min_timing: 10,       // the minimum timing for digit animation
    threshhold: 100,      // the point at which Flapper will switch from
                          // simple to detailed animations
    transform: true
}

var options = {
    width: 12,             // number of digits
    format: null,         // options for jquery.numberformatter, if loaded
    align: 'left',       // aligns values to the left or right of display
    padding: '&nbsp;',    // value to use for padding
    chars: null,          // array of characters that Flapper can display
    chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
    timing: 500,          // the maximum timing for digit animation
    min_timing: 10,       // the minimum timing for digit animation
    threshhold: 100,      // the point at which Flapper will switch from
                          // simple to detailed animations
    transform: true
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function init() {
    $("#info-line-0").flapper(infoOptions).val("").change()
    $("#info-line-1").flapper(infoOptions).val("").change()
    $("#info-line-2").flapper(infoOptions).val("").change()
    $("#info-line-3").flapper(infoOptions).val("").change()
    $("#info-line-4").flapper(infoOptions).val("").change()
    $("#info-line-5").flapper(infoOptions).val("").change()

    $("#time-line-0").flapper(options).val("").change()
    $("#time-line-1").flapper(options).val("").change()
    $("#time-line-2").flapper(options).val("").change()
    $("#time-line-3").flapper(options).val("").change()
    $("#time-line-4").flapper(options).val("").change()
    $("#time-line-5").flapper(options).val("").change()

    await runAnimation();
}

function setEnabled(lineNumber, newValue = "") {

    lineNumber = parseInt(lineNumber)
    let value = newValue;

    if (value == "") {
        value = $("#time-line-"+lineNumber).val();
    }

    $(".flapper.line.time-line-"+lineNumber).removeClass("disabled").addClass("enabled");

    $("#time-line-"+lineNumber).val(value).change()
    
}

function setDisabled(lineNumber, newValue = "") {

    lineNumber = parseInt(lineNumber)
    let value = newValue;

    if (value == "") {
        value = $("#time-line-"+lineNumber).val();
    }

    $(".flapper.line.time-line-"+lineNumber).removeClass("enabled").addClass("disabled");

    $("#time-line-"+lineNumber).val(value).change()
    
}

function setNone(lineNumber, newValue = "") {

    lineNumber = parseInt(lineNumber)
    let value = newValue;

    if (value == "") {
        value = $("#time-line-"+lineNumber).val();
    }

    $(".flapper.line.time-line-"+lineNumber).removeClass("enabled")
    $(".flapper.line.time-line-"+lineNumber).removeClass("disabled")

    $("#time-line-"+lineNumber).val(value).change()
    
}


function setInfo(lineNumber, newValue = "") {
    
    lineNumber = parseInt(lineNumber)
    let value = newValue;

    if (value == "") {
        value = $("#info-line-"+lineNumber).val();
    }

    $("#info-line-"+lineNumber).val(value).change();

}


async function runAnimation() {
    /*
    Welcome to the Flapper Board API!
    The docs are as follows:


                (integer)  (string: OPTIONAL)
    setEnabled(lineNumber, valueToSet)
        This will set the time text on line 'lineNumber' to the color green.
        If no valueToSet is given it defaults to the current one set.

                (integer)  (string: OPTIONAL)
    setDisabled(lineNumber, valueToSet)
        This will set the time text on line 'lineNumber' to the color red.
        If no valueToSet is given it defaults to the current one set.

            (integer)   (string: OPTIONAL)
    setInfo(lineNumber, valueToSet)
        This will set the informational text on line 'lineNumber' to the value specified.
        If none is given, it defaults to the value currently displayed.
    
                (integer, in milliseconds)
    await sleep(time)
        This will sleep for a given amount of time.
        This is useful for creating delays between animations.

        **NOTE**: Include 'await' in front of the 'sleep' function as shown above.
                  It will not delay the code if it is not provided.

    */

    
    
}

let index = 0;
let board = "departures";

document.onkeydown = (e) => {

    index++;
    
    
    if (e.which == 32) {
        let boardToUse = json[board];

        let changes = boardToUse[index];

        let number = changes[changes.length-1];

        for (let i = 0; i < changes.length-1; i++) {
            let stringToUse = changes[i]["number"]+" "+changes[i]["hour"]+" "+changes[i]["destination"];

            let lenPre = stringToUse.length;

            console.log(lenPre-number);
            
            for (let c = 0; c < number - (lenPre - number); c++) {
                console.log("test")
                stringToUse += " "
            }
            stringToUse += changes[i]["track"]
            setInfo(i, stringToUse);
            if (changes[i]["notes"]["color"] == "green") {
                setEnabled(i, changes[i]["notes"]["text"]);
            } else if (changes[i]["notes"]["color"] == "red") {
                setDisabled(i, changes[i]["notes"]["text"]);
            } else {
                setNone(i, changes[i]["notes"]["text"]);
            }
        }
    }

}


document.body.onload = function() {init()}